BRIQUETE.funcionario = new Object();


console.log("script ADMIN")


$(document).ready(function() {

	BRIQUETE.funcionario.cadastrar = function() {

		let novoFuncionario = new Object();

		novoFuncionario.matricula = document.frmAddFuncionario.matricula.value;
		novoFuncionario.email = document.frmAddFuncionario.email.value;
		novoFuncionario.funcao = document.frmAddFuncionario.funcao.value;
		novoFuncionario.senha = document.frmAddFuncionario.senha.value;

		if (novoFuncionario.matricula == "" || novoFuncionario.email == "" || novoFuncionario.funcao == "" || novoFuncionario.senha == ""){
	console.log("erro : preencha todos os campos!");
}else {

	$.ajax({
		type: "POST",
		url: "/PI-AssistenciaTecnica/rest/funcionario/cadastrar",
		data: JSON.stringify(novoFuncionario),
		success: function(msg) {
			console.log("adicionado novoFuncionario: " + novoFuncionario);
			BRIQUETE.funcionario.buscarFuncionarios();
		},
		error: function(info){
			console.log("error= " + info.status + " --- " + info.statusText);
	}
		});
	  }
	}

	$.ajax({

		type: "GET",
		url: BRIQUETE.PATH + "funcionario/buscar",
		success: function(dados) {
			console.log("sucesso get dados : "+dados);
			$("#lista-funcionarios").html(BRIQUETE.funcionario.exibirFuncionarios(dados));
		},
		error: function(info) {
			console.log("erro : " + info);
			//BRIQUETE.exibirAviso("Erro ao consultar os contatos: "+ info.status+" - " + info.statusText+ " - " + info.responseText);
		},

	});
};

BRIQUETE.funcionario.buscarFuncionarios(); // Fazer a instancia para a página sempre carregar a marca


BRIQUETE.funcionario.exibirFuncionarios = function(listaDeFuncionarios) {

	var tabela = "<table class='table table-bordered table-dark'>" +
		"<tr>" +
		"<th>Matricula</th>" +
		"<th>Função</th>" +
		"<th>E-mail</th>" +
		"<th>Ações</th>"
	"</tr>";

	if (listaDeFuncionarios != undefined && listaDeFuncionarios.length > 0){


		for (var i=0; listaDeFuncionarios.length; i++){	
			let nomeFuncao
			switch (listaDeFuncionarios[i].funcao){
				case 0:
					nomeFuncao = "Administrador"
					break;
				case 1:
					nomeFuncao = "Recepção"
					break;
				case 2:
					nomeFuncao = "Manutenção"
					break;
				case 3:
					nomeFuncao = "Almoxarife"
					break;
			}

			tabela += "<tr>" +
				"<td>" + listaDeFuncionarios[i].matricula + "</td>" +
				"<td>" + nomeFuncao + "</td>" +
				"<td>" + listaDeFuncionarios[i].email + "</td>" +
				"<td>" +
				"<a onclick=\"BRIQUETE.funcionario.exibirEdicao('" + listaDeFuncionarios[i].matricula + "')\"><img src='../../../imgs/edit.png' alt='Editar registro'></a>" +
				"<a onclick=\"BRIQUETE.funcionario.excluir('" + listaDeFuncionarios[i].matricula + "')\"><img src='../../../imgs/delete.png' alt='Excluir registro'></a>" +
				"</td>" +
				"</tr>"


		}

	} else if (listaDeFuncionarios == "") {
		tabela += "<tr><td colspan='6'>Nenhum registro encontrado</td></tr>";
	}
	tabela += "</table>";

	return tabela;

};


BRIQUETE.funcionario.excluir = function(matricula) {

	$.ajax({
		type: "DELETE",
		url: BRIQUETE.PATH + "funcionario/excluir/"+matricula,
		success: function(msg) {
			BRIQUETE.funcionario.buscarFuncionarios();
		},
		error: function(info) {
			console.log("Erro ao excluir produto: " + info.status + " - " + info.statusText + " - " + info.responseText);
		},
	});

};
	
	
	
});


